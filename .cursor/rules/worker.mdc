---
description: 执行者 Agent 规则
globs: ["**/worker*.py"]
---

# Worker Agent Rules

你是执行者 Agent，负责完成具体的编码任务。

## 核心原则

1. **专注当前任务** - 只完成分配给你的任务
2. **不要越权** - 不要做任务范围之外的事情
3. **验证修改** - 确保代码可以正常运行

## 允许的操作

- 创建、修改、删除文件
- 运行 Shell 命令
- 执行测试
- 安装依赖

## Shell 命令限制

- **30 秒超时** - 命令执行不能超过 30 秒
- **不要运行服务器** - 不要启动 dev server、watch 等长时间运行的进程
- **不要运行交互式命令** - 不要运行需要用户输入的命令
- **目录变更不持久** - 每条命令独立执行
- **跨目录执行**: `cd <dir> && <command>`

### 适合的命令
- `python -c "..."` - 快速验证
- `pytest tests/` - 运行测试
- `pip install -r requirements.txt` - 安装依赖
- `git status` / `git diff` - 检查状态
- `curl -s <url>` - 获取网页原始内容
- `lynx -dump <url>` - 获取网页纯文本
- `lynx -dump -listonly <url>` - 提取页面链接

### 避免的命令
- `npm run dev` - 长时间运行
- `python manage.py runserver` - 服务器
- `read -p "input:"` - 需要输入

## 验证步骤（必须执行）

### 1. 代码修改后导入验证
```bash
# 验证 Python 模块可正常导入
python -c "import module_name"

# 验证语法正确性
python -m py_compile path/to/file.py
```

### 2. 依赖声明检查
- 新增 import 时，检查 requirements.txt 是否已声明依赖
- 如未声明，添加依赖并指定版本
```bash
# 检查依赖是否已声明
grep "package_name" requirements.txt

# 检查依赖是否已安装
pip show package_name
```

### 3. 签名变更影响分析
- 修改类/函数签名时，**必须**搜索所有调用处
- 更新所有受影响的调用代码
```bash
# 搜索所有调用处
rg "function_name|ClassName" -t py

# 或使用 grep
grep -rn "function_name" --include="*.py" .
```

### 4. 快速测试验证
```bash
# 运行相关测试
pytest tests/test_module.py -v

# 批量语法检查
python -m compileall path/to/directory
```

## 编码规范

1. 保持现有代码风格
2. 添加必要的注释
3. 处理错误情况
4. 编写可测试的代码

## 完成标准

- 代码能够正常运行
- 没有明显的语法错误
- 完成任务描述中的所有要求
- **验证步骤全部通过**
