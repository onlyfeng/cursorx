# PR æ£€æŸ¥å·¥ä½œæµ
# PR äº‹ä»¶çš„ç»Ÿä¸€å…¥å£ï¼Œé€šè¿‡ workflow_call è°ƒç”¨ ci.yml/lint.yml/import-test.yml
# é¿å…è¿™äº›å·¥ä½œæµåŒæ—¶è¢« push å’Œ pull_request ç›´æ¥è§¦å‘å¯¼è‡´é‡å¤è¿è¡Œ

name: PR Check

on:
  pull_request:
    branches:
      - main
      - master
    types:
      - opened
      - synchronize
      - reopened
      - edited
      - labeled  # æ”¯æŒæ ‡ç­¾è§¦å‘ï¼ˆå¦‚ run-ml-testsï¼‰

jobs:
  # é‡ç”¨ CI å·¥ä½œæµçš„æµ‹è¯•ç»“æœ
  ci-tests:
    name: CI æµ‹è¯•
    uses: ./.github/workflows/ci.yml

  # é‡ç”¨ Lint å·¥ä½œæµçš„æ£€æŸ¥ç»“æœ
  lint-checks:
    name: Lint æ£€æŸ¥
    uses: ./.github/workflows/lint.yml

  # é‡ç”¨å¯¼å…¥æµ‹è¯•å·¥ä½œæµ
  import-tests:
    name: å¯¼å…¥æµ‹è¯•
    uses: ./.github/workflows/import-test.yml

  # è¿è¡Œå®Œæ•´çš„é¡¹ç›®å¥åº·æ£€æŸ¥
  full-check:
    name: å®Œæ•´é¡¹ç›®æ£€æŸ¥
    runs-on: ubuntu-latest
    needs: [import-tests]
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
          cache-dependency-path: |
            requirements.txt
            requirements-dev.txt
            requirements-test.txt

      - name: "å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨ pip-sync: core+dev+testï¼‰"
        run: |
          python -m pip install --upgrade pip pip-tools
          pip-sync requirements.txt requirements-dev.txt requirements-test.txt

      - name: è¿è¡Œ check_all.sh --full --json --cov-fail-under 80
        id: check_all
        run: |
          chmod +x scripts/check_all.sh
          
          # è¿è¡Œ JSON æ¨¡å¼æ£€æŸ¥
          # --cov-fail-under 80: PR gating ä½¿ç”¨ 80% è¦†ç›–ç‡é˜ˆå€¼
          # ï¼ˆCI matrix å•æµ‹ä½¿ç”¨ --cov-fail-under=0 ä»…æ”¶é›†è¦†ç›–ç‡ï¼Œä¸åšé˜ˆå€¼æ£€æŸ¥ï¼‰
          # stdout â†’ JSON æ–‡ä»¶ï¼Œstderr â†’ å•ç‹¬æ–‡ä»¶ï¼ˆä¿ç•™è¯Šæ–­ä¿¡æ¯ï¼‰
          set +e
          bash scripts/check_all.sh --full --ci --json --cov-fail-under 80 > /tmp/check_all.json 2>/tmp/check_all.stderr
          EXIT_CODE=$?
          set -e
          
          # æ¸²æŸ“ Markdown åˆ° Step Summary
          RENDER_ERROR=""
          if [ -f /tmp/check_all.json ]; then
            RENDER_ERROR=$(python scripts/render_check_all_summary.py /tmp/check_all.json 2>&1 > /tmp/render_output.md) || true
            if [ -z "$RENDER_ERROR" ] && [ -s /tmp/render_output.md ]; then
              cat /tmp/render_output.md >> $GITHUB_STEP_SUMMARY
            else
              # æ¸²æŸ“å¤±è´¥ï¼šä¼˜å…ˆå±•ç¤ºæ¸²æŸ“å™¨é”™è¯¯ + stderrï¼Œå†å±•ç¤º JSON
              echo "## âš ï¸ æ¸²æŸ“å¤±è´¥" >> $GITHUB_STEP_SUMMARY
              if [ -n "$RENDER_ERROR" ]; then
                echo "### æ¸²æŸ“å™¨é”™è¯¯" >> $GITHUB_STEP_SUMMARY
                echo '```' >> $GITHUB_STEP_SUMMARY
                echo "$RENDER_ERROR" >> $GITHUB_STEP_SUMMARY
                echo '```' >> $GITHUB_STEP_SUMMARY
              fi
              if [ -s /tmp/check_all.stderr ]; then
                echo "### check_all.sh stderr" >> $GITHUB_STEP_SUMMARY
                echo '```' >> $GITHUB_STEP_SUMMARY
                cat /tmp/check_all.stderr >> $GITHUB_STEP_SUMMARY
                echo '```' >> $GITHUB_STEP_SUMMARY
              fi
              echo "### åŸå§‹ JSON è¾“å‡º" >> $GITHUB_STEP_SUMMARY
              echo '```json' >> $GITHUB_STEP_SUMMARY
              cat /tmp/check_all.json >> $GITHUB_STEP_SUMMARY
              echo '```' >> $GITHUB_STEP_SUMMARY
            fi
          fi
          
          # æå–ç»Ÿè®¡ä¿¡æ¯ï¼ˆä» JSONï¼‰
          # æ³¨æ„ï¼šJSON è§£æå¤±è´¥æ—¶è®¾ç½® FAIL_COUNT=1ï¼Œé¿å…è¯¯æŠ¥é€šè¿‡
          JSON_PARSE_OK=true
          if [ -f /tmp/check_all.json ]; then
            PASS_COUNT=$(python3 -c "import json; d=json.load(open('/tmp/check_all.json')); print(d.get('summary',{}).get('passed',0))" 2>/dev/null) || JSON_PARSE_OK=false
            FAIL_COUNT=$(python3 -c "import json; d=json.load(open('/tmp/check_all.json')); print(d.get('summary',{}).get('failed',0))" 2>/dev/null) || JSON_PARSE_OK=false
            WARN_COUNT=$(python3 -c "import json; d=json.load(open('/tmp/check_all.json')); print(d.get('summary',{}).get('warnings',0))" 2>/dev/null) || JSON_PARSE_OK=false
            
            if [ "$JSON_PARSE_OK" = "false" ]; then
              echo "::warning::JSON è§£æå¤±è´¥ï¼Œç»Ÿè®¡ä¿¡æ¯å¯èƒ½ä¸å‡†ç¡®"
              PASS_COUNT=0
              FAIL_COUNT=1
              WARN_COUNT=0
            fi
          else
            PASS_COUNT=0
            FAIL_COUNT=1
            WARN_COUNT=0
          fi
          
          echo "pass_count=$PASS_COUNT" >> $GITHUB_OUTPUT
          echo "fail_count=$FAIL_COUNT" >> $GITHUB_OUTPUT
          echo "warn_count=$WARN_COUNT" >> $GITHUB_OUTPUT
          echo "exit_code=$EXIT_CODE" >> $GITHUB_OUTPUT
          
          # å¤±è´¥æ—¶è¾“å‡ºåŸå§‹å†…å®¹ä¾¿äºæ’æŸ¥
          if [ $EXIT_CODE -ne 0 ]; then
            echo "::group::check_all.sh åŸå§‹ JSON è¾“å‡º"
            cat /tmp/check_all.json 2>/dev/null || echo "æ—  JSON è¾“å‡ºæ–‡ä»¶"
            echo "::endgroup::"
            if [ -s /tmp/check_all.stderr ]; then
              echo "::group::check_all.sh stderr è¾“å‡º"
              cat /tmp/check_all.stderr
              echo "::endgroup::"
            fi
          fi
          
          exit $EXIT_CODE

  # ä»£ç æ ¼å¼æ£€æŸ¥
  format-check:
    name: ä»£ç æ ¼å¼æ£€æŸ¥
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
          cache-dependency-path: |
            requirements.txt
            requirements-dev.txt
            requirements-test.txt

      - name: "å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨ pip-sync: core+devï¼‰"
        run: |
          python -m pip install --upgrade pip pip-tools
          pip-sync requirements.txt requirements-dev.txt

      - name: æ£€æŸ¥ ruff æ ¼å¼
        id: ruff_format
        run: |
          echo "=== Ruff æ ¼å¼æ£€æŸ¥ ==="
          set +e
          ruff format --check . 2>&1
          RUFF_EXIT=$?
          set -e
          
          if [ $RUFF_EXIT -ne 0 ]; then
            echo "has_unformatted=true" >> $GITHUB_OUTPUT
            echo "::warning::å‘ç°æœªæ ¼å¼åŒ–çš„ä»£ç ï¼Œè¯·è¿è¡Œ 'ruff format .' ä¿®å¤"
          else
            echo "has_unformatted=false" >> $GITHUB_OUTPUT
            echo "ä»£ç æ ¼å¼æ£€æŸ¥é€šè¿‡"
          fi
          
          # ä¸é˜»æ­¢ PRï¼Œåªæ˜¯è­¦å‘Š
          exit 0

      - name: æ£€æŸ¥ import æ’åº
        id: isort_check
        run: |
          echo "=== Import æ’åºæ£€æŸ¥ ==="
          set +e
          isort --check-only --diff . 2>&1
          ISORT_EXIT=$?
          set -e
          
          if [ $ISORT_EXIT -ne 0 ]; then
            echo "imports_unsorted=true" >> $GITHUB_OUTPUT
            echo "::warning::Import æ’åºä¸æ­£ç¡®ï¼Œè¯·è¿è¡Œ 'isort .' ä¿®å¤"
          else
            echo "imports_unsorted=false" >> $GITHUB_OUTPUT
            echo "Import æ’åºæ£€æŸ¥é€šè¿‡"
          fi
          
          exit 0

  # PR æè¿°æ ¼å¼éªŒè¯
  pr-description:
    name: PR æè¿°æ ¼å¼éªŒè¯
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: éªŒè¯ PR æè¿°
        id: validate_pr
        env:
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_BODY: ${{ github.event.pull_request.body }}
        run: |
          echo "=== éªŒè¯ PR æè¿°æ ¼å¼ ==="
          
          ERRORS=()
          WARNINGS=()
          
          # æ£€æŸ¥æ ‡é¢˜æ˜¯å¦ä¸ºç©º
          if [ -z "$PR_TITLE" ]; then
            ERRORS+=("PR æ ‡é¢˜ä¸èƒ½ä¸ºç©º")
          fi
          
          # æ£€æŸ¥æ ‡é¢˜é•¿åº¦
          TITLE_LEN=${#PR_TITLE}
          if [ $TITLE_LEN -gt 100 ]; then
            WARNINGS+=("PR æ ‡é¢˜è¿‡é•¿ ($TITLE_LEN å­—ç¬¦ï¼Œå»ºè®® <= 100)")
          fi
          
          # æ£€æŸ¥æè¿°æ˜¯å¦ä¸ºç©º
          if [ -z "$PR_BODY" ]; then
            WARNINGS+=("PR æè¿°ä¸ºç©ºï¼Œå»ºè®®æ·»åŠ æè¿°è¯´æ˜")
          else
            # æ£€æŸ¥æè¿°æ˜¯å¦åŒ…å«å…³é”®éƒ¨åˆ†
            BODY_LEN=${#PR_BODY}
            
            if [ $BODY_LEN -lt 20 ]; then
              WARNINGS+=("PR æè¿°è¿‡çŸ­ ($BODY_LEN å­—ç¬¦)ï¼Œå»ºè®®æ·»åŠ æ›´å¤šè¯´æ˜")
            fi
            
            # æ£€æŸ¥æ˜¯å¦åŒ…å« Summary æˆ– æ‘˜è¦ éƒ¨åˆ†
            if echo "$PR_BODY" | grep -qiE '(##\s*(summary|æ‘˜è¦|æ¦‚è¿°|å˜æ›´è¯´æ˜))'; then
              echo "âœ“ PR æè¿°åŒ…å«æ‘˜è¦éƒ¨åˆ†"
            else
              WARNINGS+=("å»ºè®®åœ¨ PR æè¿°ä¸­æ·»åŠ  '## Summary' æˆ– '## æ‘˜è¦' éƒ¨åˆ†")
            fi
            
            # æ£€æŸ¥æ˜¯å¦åŒ…å« Test Plan æˆ– æµ‹è¯•è®¡åˆ’
            if echo "$PR_BODY" | grep -qiE '(##\s*(test\s*plan|æµ‹è¯•è®¡åˆ’|æµ‹è¯•æ–¹æ¡ˆ))'; then
              echo "âœ“ PR æè¿°åŒ…å«æµ‹è¯•è®¡åˆ’"
            else
              WARNINGS+=("å»ºè®®åœ¨ PR æè¿°ä¸­æ·»åŠ  '## Test plan' æˆ– '## æµ‹è¯•è®¡åˆ’' éƒ¨åˆ†")
            fi
          fi
          
          # è¾“å‡ºç»“æœ
          echo ""
          echo "=== éªŒè¯ç»“æœ ==="
          
          if [ ${#ERRORS[@]} -gt 0 ]; then
            echo "é”™è¯¯:"
            for err in "${ERRORS[@]}"; do
              echo "  âœ— $err"
              echo "::error::$err"
            done
          fi
          
          if [ ${#WARNINGS[@]} -gt 0 ]; then
            echo "è­¦å‘Š:"
            for warn in "${WARNINGS[@]}"; do
              echo "  âš  $warn"
              echo "::warning::$warn"
            done
          fi
          
          if [ ${#ERRORS[@]} -eq 0 ] && [ ${#WARNINGS[@]} -eq 0 ]; then
            echo "âœ“ PR æè¿°æ ¼å¼è‰¯å¥½"
          fi
          
          echo "error_count=${#ERRORS[@]}" >> $GITHUB_OUTPUT
          echo "warning_count=${#WARNINGS[@]}" >> $GITHUB_OUTPUT
          
          # åªæœ‰é”™è¯¯æ—¶æ‰å¤±è´¥
          if [ ${#ERRORS[@]} -gt 0 ]; then
            exit 1
          fi

  # æ—  API Key Smoke æµ‹è¯•ï¼ˆå¤ç”¨ CI å·¥ä½œæµï¼‰
  no-api-key-smoke:
    name: æ—  API Key Smoke æµ‹è¯•
    runs-on: ubuntu-latest
    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
          cache-dependency-path: |
            requirements.txt
            requirements-dev.txt
            requirements-test.txt

      - name: å®‰è£… pip-tools
        run: python -m pip install --upgrade pip pip-tools

      - name: "å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨ pip-sync: core onlyï¼‰"
        run: pip-sync requirements.txt

      - name: æ—  API Key Smoke æµ‹è¯•
        env:
          CURSOR_API_KEY: ""
          CURSOR_CLOUD_API_KEY: ""
        run: |
          echo "## æ—  API Key Smoke æµ‹è¯• (PR)" >> $GITHUB_STEP_SUMMARY
          
          # åŸºç¡€éªŒè¯
          python run.py --help > /dev/null 2>&1 && echo "âœ… run.py --help" >> $GITHUB_STEP_SUMMARY || exit 1
          python run.py --print-config 2>&1 | grep -qE "(requested_mode|effective_mode|config_path)" && echo "âœ… --print-config" >> $GITHUB_STEP_SUMMARY || exit 1
          python scripts/run_iterate.py --help > /dev/null 2>&1 && echo "âœ… scripts/run_iterate.py --help" >> $GITHUB_STEP_SUMMARY || exit 1
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "âœ… **æ—  API Key Smoke æµ‹è¯•é€šè¿‡**" >> $GITHUB_STEP_SUMMARY

  # æ£€æŸ¥æ‘˜è¦
  summary:
    name: æ£€æŸ¥æ‘˜è¦
    runs-on: ubuntu-latest
    needs: [import-tests, full-check, format-check, pr-description, no-api-key-smoke]
    if: always()
    steps:
      - name: ç”Ÿæˆæ£€æŸ¥æ‘˜è¦
        env:
          IMPORT_TESTS_RESULT: ${{ needs.import-tests.result }}
          FULL_CHECK_RESULT: ${{ needs.full-check.result }}
          FORMAT_CHECK_RESULT: ${{ needs.format-check.result }}
          PR_DESC_RESULT: ${{ needs.pr-description.result }}
          NO_API_KEY_SMOKE_RESULT: ${{ needs.no-api-key-smoke.result }}
          HAS_ML_LABEL: ${{ contains(github.event.pull_request.labels.*.name, 'run-ml-tests') }}
        run: |
          echo "# PR æ£€æŸ¥æ‘˜è¦" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| æ£€æŸ¥é¡¹ | ç»“æœ |" >> $GITHUB_STEP_SUMMARY
          echo "|--------|------|" >> $GITHUB_STEP_SUMMARY
          
          # å¯¼å…¥æµ‹è¯•ç»“æœ
          if [ "$IMPORT_TESTS_RESULT" = "success" ]; then
            echo "| æ¨¡å—å¯¼å…¥æµ‹è¯• | âœ… é€šè¿‡ |" >> $GITHUB_STEP_SUMMARY
          elif [ "$IMPORT_TESTS_RESULT" = "failure" ]; then
            echo "| æ¨¡å—å¯¼å…¥æµ‹è¯• | âŒ å¤±è´¥ |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| æ¨¡å—å¯¼å…¥æµ‹è¯• | âš ï¸ $IMPORT_TESTS_RESULT |" >> $GITHUB_STEP_SUMMARY
          fi
          
          # å®Œæ•´æ£€æŸ¥ç»“æœ
          if [ "$FULL_CHECK_RESULT" = "success" ]; then
            echo "| å®Œæ•´é¡¹ç›®æ£€æŸ¥ | âœ… é€šè¿‡ |" >> $GITHUB_STEP_SUMMARY
          elif [ "$FULL_CHECK_RESULT" = "failure" ]; then
            echo "| å®Œæ•´é¡¹ç›®æ£€æŸ¥ | âŒ å¤±è´¥ |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| å®Œæ•´é¡¹ç›®æ£€æŸ¥ | âš ï¸ $FULL_CHECK_RESULT |" >> $GITHUB_STEP_SUMMARY
          fi
          
          # æ ¼å¼æ£€æŸ¥ç»“æœ
          if [ "$FORMAT_CHECK_RESULT" = "success" ]; then
            echo "| ä»£ç æ ¼å¼æ£€æŸ¥ | âœ… é€šè¿‡ |" >> $GITHUB_STEP_SUMMARY
          elif [ "$FORMAT_CHECK_RESULT" = "failure" ]; then
            echo "| ä»£ç æ ¼å¼æ£€æŸ¥ | âŒ å¤±è´¥ |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| ä»£ç æ ¼å¼æ£€æŸ¥ | âš ï¸ $FORMAT_CHECK_RESULT |" >> $GITHUB_STEP_SUMMARY
          fi
          
          # PR æè¿°éªŒè¯ç»“æœ
          if [ "$PR_DESC_RESULT" = "success" ]; then
            echo "| PR æè¿°æ ¼å¼ | âœ… é€šè¿‡ |" >> $GITHUB_STEP_SUMMARY
          elif [ "$PR_DESC_RESULT" = "failure" ]; then
            echo "| PR æè¿°æ ¼å¼ | âŒ å¤±è´¥ |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| PR æè¿°æ ¼å¼ | âš ï¸ $PR_DESC_RESULT |" >> $GITHUB_STEP_SUMMARY
          fi
          
          # æ—  API Key Smoke æµ‹è¯•ç»“æœ
          if [ "$NO_API_KEY_SMOKE_RESULT" = "success" ]; then
            echo "| æ—  API Key Smoke | âœ… é€šè¿‡ |" >> $GITHUB_STEP_SUMMARY
          elif [ "$NO_API_KEY_SMOKE_RESULT" = "failure" ]; then
            echo "| æ—  API Key Smoke | âŒ å¤±è´¥ |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| æ—  API Key Smoke | âš ï¸ $NO_API_KEY_SMOKE_RESULT |" >> $GITHUB_STEP_SUMMARY
          fi
          
          # ML æµ‹è¯•æç¤º
          if [ "$HAS_ML_LABEL" = "true" ]; then
            echo "| ML æµ‹è¯• (çŸ¥è¯†åº“/å‘é‡) | ğŸƒ å·²é€šè¿‡æ ‡ç­¾è§¦å‘ï¼Œè§ CI å·¥ä½œæµ |" >> $GITHUB_STEP_SUMMARY
          else
            echo "| ML æµ‹è¯• (çŸ¥è¯†åº“/å‘é‡) | â­ï¸ æœªè§¦å‘ (æ·»åŠ  \`run-ml-tests\` æ ‡ç­¾å¯ç”¨) |" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          # æ€»ä½“ç»“æœ
          if [ "$IMPORT_TESTS_RESULT" = "success" ] && [ "$FULL_CHECK_RESULT" = "success" ] && [ "$PR_DESC_RESULT" = "success" ] && [ "$NO_API_KEY_SMOKE_RESULT" = "success" ]; then
            echo "## âœ… æ‰€æœ‰å¿…è¦æ£€æŸ¥é€šè¿‡" >> $GITHUB_STEP_SUMMARY
          else
            echo "## âŒ éƒ¨åˆ†æ£€æŸ¥æœªé€šè¿‡ï¼Œè¯·æŸ¥çœ‹è¯¦æƒ…" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### æç¤º" >> $GITHUB_STEP_SUMMARY
          echo "- è¿è¡Œ \`bash scripts/check_all.sh --full\` æœ¬åœ°æ£€æŸ¥" >> $GITHUB_STEP_SUMMARY
          echo "- è¿è¡Œ \`python scripts/pre_commit_check.py --quick\` æ£€æŸ¥æ¨¡å—å¯¼å…¥" >> $GITHUB_STEP_SUMMARY
          echo "- è¿è¡Œ \`ruff format .\` è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç " >> $GITHUB_STEP_SUMMARY
          echo "- è¿è¡Œ \`isort .\` è‡ªåŠ¨æ’åº imports" >> $GITHUB_STEP_SUMMARY
          echo "- æ·»åŠ  \`run-ml-tests\` æ ‡ç­¾è¿è¡Œ ML æµ‹è¯• (çŸ¥è¯†åº“/å‘é‡ç´¢å¼•)" >> $GITHUB_STEP_SUMMARY

      - name: æ£€æŸ¥æ˜¯å¦åº”è¯¥å¤±è´¥
        env:
          IMPORT_TESTS_RESULT: ${{ needs.import-tests.result }}
          FULL_CHECK_RESULT: ${{ needs.full-check.result }}
          PR_DESC_RESULT: ${{ needs.pr-description.result }}
          NO_API_KEY_SMOKE_RESULT: ${{ needs.no-api-key-smoke.result }}
        run: |
          # å¯¼å…¥æµ‹è¯•ã€å®Œæ•´æ£€æŸ¥ã€PR æè¿°å’Œæ—  API Key Smoke æ˜¯å¿…é¡»é€šè¿‡çš„
          if [ "$IMPORT_TESTS_RESULT" = "failure" ] || [ "$FULL_CHECK_RESULT" = "failure" ] || [ "$PR_DESC_RESULT" = "failure" ] || [ "$NO_API_KEY_SMOKE_RESULT" = "failure" ]; then
            echo "å¿…è¦æ£€æŸ¥æœªé€šè¿‡"
            exit 1
          fi
          echo "æ‰€æœ‰å¿…è¦æ£€æŸ¥é€šè¿‡"
