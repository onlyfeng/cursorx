# 规划者-执行者 多Agent系统 配置文件

# 系统配置
system:
  max_iterations: 10        # 最大迭代次数
  worker_pool_size: 3       # Worker 池大小
  enable_sub_planners: true # 是否启用子规划者
  strict_review: false      # 严格评审模式

# 模型配置 - 不同 Agent 使用不同模型
# 适用于: 基本模式 (run.py) 和 多进程模式 (run_mp.py)
# 使用 `agent models` 查看完整可用模型列表
models:
  # 规划者模型 - GPT 5.2 High 擅长高层规划和任务分解
  planner: gpt-5.2-high

  # 执行者模型 - Claude 4.5 Opus (Thinking) 擅长代码生成
  worker: opus-4.5-thinking

  # 评审者模型 - Claude 4.5 Opus (Thinking) 擅长代码审查
  reviewer: opus-4.5-thinking

# 可用模型列表 (2026-01):
# - gpt-5.2-high      : GPT-5.2 High
# - gpt-5.2           : GPT-5.2
# - gpt-5.2-codex     : GPT-5.2 Codex
# - opus-4.5-thinking : Claude 4.5 Opus (Thinking) [默认]
# - opus-4.5          : Claude 4.5 Opus
# - sonnet-4.5-thinking: Claude 4.5 Sonnet (Thinking)
# - sonnet-4.5        : Claude 4.5 Sonnet
# - gemini-3-pro      : Gemini 3 Pro
# - gemini-3-flash    : Gemini 3 Flash
# - grok              : Grok

# agent CLI 配置
# 安装: curl https://cursor.com/install -fsS | bash
# 身份验证: export CURSOR_API_KEY=your_api_key_here
agent_cli:
  path: agent               # agent CLI 路径
  timeout: 300              # 超时时间（秒）
  max_retries: 3            # 最大重试次数
  output_format: text       # 输出格式: text, json, stream-json
  # api_key: ""             # API 密钥（可选，推荐使用环境变量）

# Cloud Agent 配置
# 提供云端 API 访问能力，支持程序化调用 Cursor Agent
# 执行模式:
#   - cli:   使用本地 agent CLI 执行（需要安装 cursor CLI）
#   - cloud: 使用 Cloud API 执行（需要 API 密钥）
#   - auto:  自动选择（优先使用 cloud，失败时降级到 cli）
cloud_agent:
  enabled: false                              # 是否启用 Cloud Agent
  execution_mode: cli                         # 执行模式: cli | cloud | auto

  # Cloud API 配置
  api_base_url: "https://api.cursor.com"      # API 基础 URL
  # api_key: ""                               # API 密钥（推荐使用环境变量 CURSOR_API_KEY 或 CURSOR_CLOUD_API_KEY）
  timeout: 300                                # 请求超时时间（秒）
  max_retries: 3                              # 最大重试次数

  # 出口 IP 验证配置（用于验证请求来源）
  egress_ip_cache_ttl: 3600                   # 出口 IP 缓存有效期（秒），默认 1 小时
  egress_ip_api_url: ""                       # 自定义 IP 范围 API URL（可选，留空使用默认）
  verify_egress_ip: false                     # 是否验证出口 IP

# 网络配置
# 代理和 SSL 设置，影响所有外部网络请求
network:
  proxy_url: ""                               # HTTP/HTTPS 代理 URL（如 http://proxy.example.com:8080）
  ssl_verify: true                            # 是否验证 SSL 证书（生产环境建议保持 true）

# 规划者配置
planner:
  max_sub_planners: 3       # 最大子规划者数量
  max_tasks_per_plan: 10    # 单次规划最大任务数
  exploration_depth: 3      # 探索深度
  timeout: 180              # 规划超时（秒）

# 执行者配置
worker:
  task_timeout: 300         # 任务超时时间（秒）
  max_concurrent_tasks: 1   # 同时处理的任务数

# 评审者配置
reviewer:
  strict_mode: false        # 严格模式
  timeout: 120              # 评审超时（秒）

# 索引配置 - 语义搜索支持
indexing:
  enabled: true                              # 是否启用语义索引
  model: all-MiniLM-L6-v2                    # 嵌入模型（本地 sentence-transformers）
  persist_path: .cursor/vector_index/        # 向量索引持久化路径
  chunk_size: 500                            # 分块大小（字符数）
  chunk_overlap: 50                          # 分块重叠
  # 文件过滤
  include_patterns:
    - "**/*.py"
    - "**/*.js"
    - "**/*.ts"
    - "**/*.go"
    - "**/*.rs"
  exclude_patterns:
    - "**/node_modules/**"
    - "**/.git/**"
    - "**/venv/**"
    - "**/__pycache__/**"
    - "**/dist/**"
    - "**/build/**"
  # 搜索选项
  search:
    top_k: 10                                # 默认返回结果数
    min_score: 0.3                           # 最低相似度阈值
    include_context: true                    # 是否包含上下文
    context_lines: 3                         # 上下文行数

# 日志配置
logging:
  level: INFO               # 日志级别: DEBUG, INFO, WARNING, ERROR
  file: logs/agent.log      # 日志文件
  rotation: 10 MB           # 日志轮转大小
  retention: 7 days         # 日志保留时间
  stream_json:
    enabled: false          # 是否启用 stream-json 流式日志
    console: true           # 是否输出到控制台
    detail_dir: logs/stream_json/detail/  # 详细日志目录
    raw_dir: logs/stream_json/raw/        # 原始 NDJSON 目录
